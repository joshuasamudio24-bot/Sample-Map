<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <link rel="stylesheet" href="./resources/ol.css">
        <link rel="stylesheet" href="resources/fontawesome-all.min.css">
        <link rel="stylesheet" type="text/css" href="resources/horsey.min.css">
        <link rel="stylesheet" type="text/css" href="resources/ol3-search-layer.min.css">
        <link rel="stylesheet" href="./resources/ol-layerswitcher.css">
        <link rel="stylesheet" href="./resources/qgis2web.css">
        <style>
        html, body {
            background-color: #ffffff;
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }
        .ol-control > * {
            background-color: #f8f8f8!important;
            color: #444444!important;
            border-radius: 0px;
        }
        .ol-attribution a, .gcd-gl-input::placeholder, .search-layer-input-search::placeholder {
            color: #444444!important;
        }
        .search-layer-input-search {
            background-color: #f8f8f8!important;
        }
        .ol-control > *:focus, .ol-control >*:hover {
            background-color: rgba(248, 248, 248, 0.7)!important;
        } 
        .ol-control {
            background-color: rgba(255,255,255,.4) !important;
            padding: 2px !important;
        }
        
        /* Search Bar Styles */
            #search-container, #dual-search-container {
                position: absolute;
                top: 10px;
                left: 50%;
                transform: translateX(-50%);
                z-index: 1000; /* Ensure it's above map elements */
                background: rgba(255, 255, 255, 0.95);
                padding: 10px;
                border-radius: 5px;
                box-shadow: 0 2px 6px rgba(0,0,0,0.3);
                width: 350px; /* Adjusted width to accommodate autocomplete dropdown */
                box-sizing: border-box; /* Include padding and border in width */
                display: flex; /* Use Flexbox for alignment */
                align-items: center;
            }

            #dual-search-container {
                width: 500px;
                display: none;
                gap: 10px;
            }

            #search-container input, #dual-search-container input {
                flex: 1;
                padding: 8px 12px;
                border: 1px solid #ccc;
                border-radius: 4px;
                font-size: 14px;
                box-sizing: border-box; /* Include padding and border in width */
            }

            #route-button {
                padding: 8px 12px;
                margin-left: 5px;
                border: none;
                background-color: #007BFF;
                color: white;
                border-radius: 4px;
                cursor: pointer;
                font-size: 14px;
            }

            #route-button:hover {
                background-color: #0056b3;
            }

            #destination-button {
                padding: 8px 12px;
                margin-left: 5px;
                border: none;
                background-color: #28a745; /* Green color for destination */
                color: white;
                border-radius: 4px;
                cursor: pointer;
                font-size: 14px;
            }

            #destination-button:hover {
                background-color: #1e7e34;
            }

            #destination-button i {
                pointer-events: none;
            }

            /* Updated Marker Styles */
            

            /* Popup Styles */
            .ol-popup {
                position: absolute;
                background-color: white;
                box-shadow: 0 1px 4px rgba(0,0,0,0.2);
                padding: 15px;
                border-radius: 10px;
                border: 1px solid #cccccc;
                min-width: 180px;
                display: none; /* Initially hidden */
                z-index: 1000; /* Ensure it's above other map elements */
            }
            .ol-popup:after, .ol-popup:before {
                border: solid transparent;
                content: " ";
                height: 0;
                width: 0;
                position: absolute;
                pointer-events: none;
            }
            .ol-popup:after {
                border-top-color: white;
                border-width: 10px;
                left: 48px;
                margin-left: -10px;
            }
            .ol-popup:before {
                border-top-color: #cccccc;
                border-width: 11px;
                left: 48px;
                margin-left: -10px;
            }
            .ol-popup-closer {
                text-decoration: none;
                position: absolute;
                top: 2px;
                right: 8px;
                font-weight: bold;
                color: #aaa;
            }
            .ol-popup-closer:hover {
                color: #000;
            }

                        /* Styling for the new ETA popup */
            #eta-popup {
                position: absolute;
                background-color: white;
                box-shadow: 0 1px 4px rgba(0, 0, 0, 0.2);
                padding: 15px;
                border-radius: 10px;
                border: 1px solid #cccccc;
                min-width: 180px;
                display: none; /* Initially hidden */
                z-index: 1000; /* Ensure it's above other map elements */
            }

            /* Popup arrow */
            #eta-popup:after, #eta-popup:before {
                border: solid transparent;
                content: " ";
                height: 0;
                width: 0;
                position: absolute;
                pointer-events: none;
                bottom: -15px; /* Adjust based on triangle size */
                left: 55%;      /* Center horizontally */
                transform: translateX(-50%); /* Center the triangle */
            }

            #eta-popup:after {
                border-top-color: white;
                border-width: 10px;
            }

            #eta-popup:before {
                border-top-color: #cccccc;
                border-width: 11px;
            }

            /* Close button */
            #eta-popup-closer {
                text-decoration: none;
                position: absolute;
                top: 2px;
                right: 8px;
                font-weight: bold;
                color: #aaa;
            }
            #eta-popup-closer:hover {
                color: #000;
            }

            /* Styling the content inside the new ETA popup */
            #eta-popup-content {
                font-size: 14px;
                color: #333;
                line-height: 1.5;
            }
            /* Street View Panorama Container */
            #street-view-panorama {
                position: absolute;
                bottom: 0;
                left: 0;
                width: 100%;
                height: 400px;
                z-index: 1003;
                background: #fff;
                display: none;
                border-top: 4px solid #FAF9F6;/* Adds a distinct top border */
                box-shadow: 0 -2px 6px rgba(0, 0, 0, 0.3); /* Optional: Adds shadow for depth */
                overflow: hidden; /* Prevents content from overflowing */
                transition: all 0.3s ease; /* Smooth transition for appearance */
            }

            /* Close Button Styles */
            #close-street-view {
                position: absolute;
                bottom: 420px;
                left: 10px;
                z-index: 1004;
                padding: 8px 12px;
                background-color: #dc3545;
                color: white;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                display: none;
            }

            /* Hover Effect for Close Button */
            #close-street-view:hover {
                background-color: #c82333;
            }

            /* Pegman Icon Styles */
            #street-view-icon {
                position: fixed !important;
                top: 850px !important;
                left: 20px !important;
                z-index: 1002 !important;
                cursor: grab !important;
                width: 40px !important;
                height: 40px !important;
                transition: transform 0.03s ease; /* Smooth transition for transform */
                transform: translate(0px, 0px); /* Initial transform */
            }


            #street-view-icon.dragging {
                cursor: grabbing;
                opacity: 0.8; /* Slight transparency during drag */
            }
            

            #gmap-coverage {
            pointer-events: none; /* So you can interact with OL map behind it */
            }

            /* Try hiding the Google Maps base tile layer */
            #gmap-coverage .gm-style > div:first-child {
            opacity: 0 !important;
            }
        </style>

        <style>
        html, body, #map {
            overflow: hidden;
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }
        .popup {
            font-family: "Aptos Narrow", sans-serif;
            color: #333;
            background: transparent;
            border: none;
            border-radius: 0;
            padding: 0;
        }

        .popup .header {
            font-size: 18px;
            font-weight: bold;
            margin: 0;
            line-height: 1.2;
            color: #333;
        }

        .popup p {
            font-size: 14px;
            margin: 0;
            line-height: 1.2;
            background: transparent;
        }

        .popup p strong {
            font-size: 14px;
        }

        .popup table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 5px;
            background: transparent;
        }

        .popup th, .popup td {
            border: 1px solid #ddd;
            padding: 6px;
            text-align: left;
            font-size: 12px;
            line-height: 1.2;
            background: #fafafa;
        }

        .popup th {
            background-color: #E08E5F;
            color: #FFF;
            font-weight: bold;
            font-size: 13px;
        }

        .popup tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        </style>
        <title>Ballarat Webmap</title>
    </head>
    <body>
        <div id="map">
            <div id="popup" class="ol-popup">
                <a href="#" id="popup-closer" class="ol-popup-closer"></a>
                <div id="popup-content"></div>
            </div>
        </div>

        <!-- Load Google Maps JavaScript API with Places library for Autocomplete and Geometry for decoding polylines -->
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC9b66RtsjMvLfvEoyH9VtxSnqnbRRfnfc&libraries=places,geometry"></script>
    </head>
    <body>
        <!-- Single Search Bar -->
        <div id="search-container">
            <input type="text" id="address-input" placeholder="Enter address">
            <button id="destination-button" title="Set Destination">
                <i class="fas fa-map-marker-alt"></i>
            </button>
            
        </div>

        <!-- Dual Search Bar for Origin and Destination -->
        <div id="dual-search-container">
            <input type="text" id="origin-input" placeholder="Enter starting address">
            <input type="text" id="destination-input" placeholder="Enter destination address">
            <button id="route-button">Get Route</button>
        </div>

        <div id="map">
            <!-- Existing popup for parcels -->
            <div id="popup" class="ol-popup">
                <a href="#" id="popup-closer" class="ol-popup-closer"></a>
                <div id="popup-content"></div>
            </div>
        
            <!-- New popup for ETA and Distance -->
            <div id="eta-popup" class="ol-popup">
                <a href="#" id="eta-popup-closer" class="ol-popup-closer"></a>
                <div id="eta-popup-content"></div>
            </div>
        </div>
        
        <div id="street-view-panorama" style="width: 100%; height: 720px; display: none; position: absolute; bottom: 0; left: 0; z-index: 1003;"></div>
        <button id="close-street-view" style="position: absolute; bottom: 680px; left: 46%; z-index: 1004; display: none;">Close Street View</button>
       
        <div id="street-view-icon" title="Drag to Street View" style="position: absolute; top: 850px; left: 25px; z-index: 1002; cursor: grab;">
            <img src="streetview/pegman.png" alt="Street View" width="40" height="40">
        </div>

        <div id="gmap-coverage" style="position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; display:none; z-index:999;">
        </div>
        
        <script src="resources/qgis2web_expressions.js"></script>
        <script src="./resources/functions.js"></script>
        <script src="./resources/ol.js"></script>
        <script src="resources/horsey.min.js"></script>
        <script src="resources/ol3-search-layer.js"></script>
        <script src="./resources/ol-layerswitcher.js"></script>
        <script src="layers/TRZ1StateTransportInfrastructure_2.js"></script><script src="layers/TRZ2PrincipalRoadNetwork_3.js"></script><script src="layers/TRZ4OtherTransportUse_4.js"></script><script src="layers/TRZ3SignificantMunicipalRoad_5.js"></script><script src="layers/PCRZPublicConservationandResourceZone_6.js"></script><script src="layers/PPRZPublicParkandRecreationZone_7.js"></script><script src="layers/PUZ2PublicUseZoneEducation_8.js"></script><script src="layers/PUZ1PublicUseZoneServiceandUtility_9.js"></script><script src="layers/PUZ3PublicUseZoneHealthCommunity_10.js"></script><script src="layers/PUZ6PublicUseZoneLocalGovernment_11.js"></script><script src="layers/PUZ7PublicUseZoneOtherPublicUse_12.js"></script><script src="layers/GWAZGreenWedgeAZone_13.js"></script><script src="layers/GWZGreenWedgeZone_14.js"></script><script src="layers/RCZRuralConservationZone_15.js"></script><script src="layers/RAZRuralActivityZone_16.js"></script><script src="layers/DZDocklandZone_17.js"></script><script src="layers/SUZSpecialUseZone_18.js"></script><script src="layers/PZPortZone_19.js"></script><script src="layers/UFZUrbanFloodwayZone_20.js"></script><script src="layers/C2ZCommercial2Zone_21.js"></script><script src="layers/C1ZCommercial1Zone_22.js"></script><script src="layers/IN1ZIndustrial1Zone_23.js"></script><script src="layers/IN2ZIndustrial2Zone_24.js"></script><script src="layers/RLZRuralLivingZone_25.js"></script><script src="layers/IN3ZIndustrial3Zone_26.js"></script><script src="layers/FZFarmingZone_27.js"></script><script src="layers/CCZCapitalCityZone_28.js"></script><script src="layers/ACZActivityCentreZone_29.js"></script><script src="layers/CDZComprehensiveDevelopmentZone_30.js"></script><script src="layers/GRZGeneralResidentialZone_31.js"></script><script src="layers/MUZMixedUseZone_32.js"></script><script src="layers/LDRZLowDensityResidentialZone_33.js"></script><script src="layers/PDZPriorityDevelopmentZone_34.js"></script><script src="layers/NRZNeighbourhoodResidentialZone_35.js"></script><script src="layers/RGZResidentialGrowthZone_36.js"></script><script src="layers/TZTownshipZone_37.js"></script><script src="layers/UGZUrbanGrowthZone_38.js"></script><script src="layers/SMOSalinityManagementOverlay_39.js"></script><script src="layers/SCOSpecificControlsOverlay_40.js"></script><script src="layers/RSARecognitionandSettlementAgreement_41.js"></script><script src="layers/RFORuralFloodwayOverlay_42.js"></script><script src="layers/RAPRegisteredAboriginalParties_43.js"></script><script src="layers/EMOErosionManagementOverlay_44.js"></script><script src="layers/EAOEnvironmentalAuditOverlay_45.js"></script><script src="layers/DPODevelopmentPlanOverlay_46.js"></script><script src="layers/DDODesignandDevelopmentOverlay_47.js"></script><script src="layers/DCPODevelopmentContributionsPlanOverlay_48.js"></script><script src="layers/AEOAirportEnvironsOverlay_49.js"></script><script src="layers/BAOBufferAreaOverlay_50.js"></script><script src="layers/BMOBushfireManagementOverlay_51.js"></script><script src="layers/ESOEnvironmentalSignificanceOverlay_52.js"></script><script src="layers/PAOPublicAcquisitionOverlay_53.js"></script><script src="layers/RORestructureOverlay_54.js"></script><script src="layers/RXORoadClosureOverlay_55.js"></script><script src="layers/SLOSignificantLandscapeOverlay_56.js"></script><script src="layers/SROStateResourceOverlay_57.js"></script><script src="layers/SteepSlope_58.js"></script><script src="layers/Easements_59.js"></script><script src="layers/WBWaterwaysBuffered_60.js"></script><script src="layers/FOFloodwayOverlay_61.js"></script><script src="layers/HeritageRegister_62.js"></script><script src="layers/HOHeritageOverlay_63.js"></script><script src="layers/LSIOLandSubjecttoInundationOverlay_64.js"></script><script src="layers/VPOVegetationProtectionOverlay_65.js"></script><script src="layers/SSPFloodScenario5_66.js"></script><script src="layers/BallaratWestGrowthArea_67.js"></script><script src="layers/BallaratNorthWesternGrowthArea_68.js"></script><script src="layers/BallaratNorthPSPExpandedArea_69.js"></script><script src="layers/BallaratNorthPSPCoreArea_70.js"></script><script src="layers/BallaratWestPSPBoundary_71.js"></script><script src="layers/AlfredtonWestPSP_72.js"></script><script src="layers/Unzoned_79.js"></script><script src="layers/Rezone_80.js"></script><script src="layers/Zoned_81.js"></script><script src="layers/Suburb_82.js"></script><script src="layers/BallaratLGA_83.js"></script><script src="layers/Estate_84.js"></script><script src="layers/MajorLandOwner_85.js"></script><script src="layers/Estatelabel_86.js"></script><script src="layers/ParcelAttributesLabel_87.js"></script>
        <script src="styles/TRZ1StateTransportInfrastructure_2_style.js"></script><script src="styles/TRZ2PrincipalRoadNetwork_3_style.js"></script><script src="styles/TRZ4OtherTransportUse_4_style.js"></script><script src="styles/TRZ3SignificantMunicipalRoad_5_style.js"></script><script src="styles/PCRZPublicConservationandResourceZone_6_style.js"></script><script src="styles/PPRZPublicParkandRecreationZone_7_style.js"></script><script src="styles/PUZ2PublicUseZoneEducation_8_style.js"></script><script src="styles/PUZ1PublicUseZoneServiceandUtility_9_style.js"></script><script src="styles/PUZ3PublicUseZoneHealthCommunity_10_style.js"></script><script src="styles/PUZ6PublicUseZoneLocalGovernment_11_style.js"></script><script src="styles/PUZ7PublicUseZoneOtherPublicUse_12_style.js"></script><script src="styles/GWAZGreenWedgeAZone_13_style.js"></script><script src="styles/GWZGreenWedgeZone_14_style.js"></script><script src="styles/RCZRuralConservationZone_15_style.js"></script><script src="styles/RAZRuralActivityZone_16_style.js"></script><script src="styles/DZDocklandZone_17_style.js"></script><script src="styles/SUZSpecialUseZone_18_style.js"></script><script src="styles/PZPortZone_19_style.js"></script><script src="styles/UFZUrbanFloodwayZone_20_style.js"></script><script src="styles/C2ZCommercial2Zone_21_style.js"></script><script src="styles/C1ZCommercial1Zone_22_style.js"></script><script src="styles/IN1ZIndustrial1Zone_23_style.js"></script><script src="styles/IN2ZIndustrial2Zone_24_style.js"></script><script src="styles/RLZRuralLivingZone_25_style.js"></script><script src="styles/IN3ZIndustrial3Zone_26_style.js"></script><script src="styles/FZFarmingZone_27_style.js"></script><script src="styles/CCZCapitalCityZone_28_style.js"></script><script src="styles/ACZActivityCentreZone_29_style.js"></script><script src="styles/CDZComprehensiveDevelopmentZone_30_style.js"></script><script src="styles/GRZGeneralResidentialZone_31_style.js"></script><script src="styles/MUZMixedUseZone_32_style.js"></script><script src="styles/LDRZLowDensityResidentialZone_33_style.js"></script><script src="styles/PDZPriorityDevelopmentZone_34_style.js"></script><script src="styles/NRZNeighbourhoodResidentialZone_35_style.js"></script><script src="styles/RGZResidentialGrowthZone_36_style.js"></script><script src="styles/TZTownshipZone_37_style.js"></script><script src="styles/UGZUrbanGrowthZone_38_style.js"></script><script src="styles/SMOSalinityManagementOverlay_39_style.js"></script><script src="styles/SCOSpecificControlsOverlay_40_style.js"></script><script src="styles/RSARecognitionandSettlementAgreement_41_style.js"></script><script src="styles/RFORuralFloodwayOverlay_42_style.js"></script><script src="styles/RAPRegisteredAboriginalParties_43_style.js"></script><script src="styles/EMOErosionManagementOverlay_44_style.js"></script><script src="styles/EAOEnvironmentalAuditOverlay_45_style.js"></script><script src="styles/DPODevelopmentPlanOverlay_46_style.js"></script><script src="styles/DDODesignandDevelopmentOverlay_47_style.js"></script><script src="styles/DCPODevelopmentContributionsPlanOverlay_48_style.js"></script><script src="styles/AEOAirportEnvironsOverlay_49_style.js"></script><script src="styles/BAOBufferAreaOverlay_50_style.js"></script><script src="styles/BMOBushfireManagementOverlay_51_style.js"></script><script src="styles/ESOEnvironmentalSignificanceOverlay_52_style.js"></script><script src="styles/PAOPublicAcquisitionOverlay_53_style.js"></script><script src="styles/RORestructureOverlay_54_style.js"></script><script src="styles/RXORoadClosureOverlay_55_style.js"></script><script src="styles/SLOSignificantLandscapeOverlay_56_style.js"></script><script src="styles/SROStateResourceOverlay_57_style.js"></script><script src="styles/SteepSlope_58_style.js"></script><script src="styles/Easements_59_style.js"></script><script src="styles/WBWaterwaysBuffered_60_style.js"></script><script src="styles/FOFloodwayOverlay_61_style.js"></script><script src="styles/HeritageRegister_62_style.js"></script><script src="styles/HOHeritageOverlay_63_style.js"></script><script src="styles/LSIOLandSubjecttoInundationOverlay_64_style.js"></script><script src="styles/VPOVegetationProtectionOverlay_65_style.js"></script><script src="styles/SSPFloodScenario5_66_style.js"></script><script src="styles/BallaratWestGrowthArea_67_style.js"></script><script src="styles/BallaratNorthWesternGrowthArea_68_style.js"></script><script src="styles/BallaratNorthPSPExpandedArea_69_style.js"></script><script src="styles/BallaratNorthPSPCoreArea_70_style.js"></script><script src="styles/BallaratWestPSPBoundary_71_style.js"></script><script src="styles/AlfredtonWestPSP_72_style.js"></script><script src="styles/Unzoned_79_style.js"></script><script src="styles/Rezone_80_style.js"></script><script src="styles/Zoned_81_style.js"></script><script src="styles/Suburb_82_style.js"></script><script src="styles/BallaratLGA_83_style.js"></script><script src="styles/Estate_84_style.js"></script><script src="styles/MajorLandOwner_85_style.js"></script><script src="styles/Estatelabel_86_style.js"></script><script src="styles/ParcelAttributesLabel_87_style.js"></script>
        <script src="./layers/layers.js" type="text/javascript"></script> 
        <script src="./resources/Autolinker.min.js"></script>
        <script src="./resources/qgis2web.js"></script>

        <script src="streetview/streetview.js"></script>
        <script src="streetview/streethighlights.js"></script>

        <!-- Added Search Functionality Script with Autocomplete -->
        <script>
            // Ensure the Google Maps API is loaded
            if (typeof google === 'undefined') {
               console.error('Google Maps JavaScript API not loaded.');
           } else {
               // Initialize Autocomplete after the API is loaded
               function initAutocomplete() {
                   const addressInput = document.getElementById('address-input');
                   const originInput = document.getElementById('origin-input');
                   const destinationInput = document.getElementById('destination-input');

                   // Single Address Autocomplete
                   const autocompleteSingle = new google.maps.places.Autocomplete(addressInput, {
                       // types: ['geocode'], // Restrict to geographical location types
                       componentRestrictions: { country: 'au' } // Optional: Restrict to Australia
                   });

                   autocompleteSingle.addListener('place_changed', function() {
                       const place = autocompleteSingle.getPlace();
                       if (!place.geometry) {
                           // User entered the name of a Place that was not suggested and pressed the Enter key
                           alert("No details available for input: '" + place.name + "'");
                           return;
                       }

                       // Extract the location coordinates
                       const lat = place.geometry.location.lat();
                       const lng = place.geometry.location.lng();

                       // Convert latitude and longitude to OpenLayers coordinates
                       const olCoord = ol.proj.fromLonLat([lng, lat]);

                       // Pan the map to the location with animation
                       map.getView().animate({
                           center: olCoord,
                           zoom: 14, // Adjust zoom level as needed
                           duration: 2000
                       });

                       // Add a marker at the location
                       addMarker(olCoord, place.formatted_address);
                   });

                   // Dual Address Autocomplete
                   const autocompleteOrigin = new google.maps.places.Autocomplete(originInput, {
                       // types: ['geocode'],
                       componentRestrictions: { country: 'au' }
                   });

                   const autocompleteDestination = new google.maps.places.Autocomplete(destinationInput, {
                       // types: ['geocode'],
                       componentRestrictions: { country: 'au' }
                   });
               }

               // Function to add a marker to the map
               function addMarker(coordinate, address) {
                    // Remove existing marker if any
                    const existingMarker = map.getOverlayById('search-marker');
                    if (existingMarker) {
                        map.removeOverlay(existingMarker);
                    }

                    // Create a new marker element
                    const markerElement = document.createElement('div');
                    markerElement.className = 'search-marker';

                    // Add the Font Awesome icon to the marker
                    markerElement.innerHTML = `
                        <i class="fas fa-map-marker-alt" style="color: #FF0000; font-size: 30px;"></i>
                    `;

                    // Create an OpenLayers overlay for the marker
                    const markerOverlay = new ol.Overlay({
                        position: coordinate,
                        positioning: 'center-center',
                        element: markerElement,
                        stopEvent: false,
                        id: 'search-marker'
                    });

                    // Add the overlay to the map
                    map.addOverlay(markerOverlay);
                }


               // Routing Functionality
               function initRouting() {
                   document.getElementById('route-button').addEventListener('click', function() {
                       const origin = document.getElementById('origin-input').value;
                       const destination = document.getElementById('destination-input').value;

                       if (!origin || !destination) {
                           alert('Please enter both origin and destination addresses.');
                           return;
                       }

                       // Use Geocoding to get coordinates for origin and destination
                       const geocoder = new google.maps.Geocoder();

                       geocoder.geocode({ 'address': origin }, function(originResults, originStatus) {
                           if (originStatus !== 'OK') {
                               alert('Geocode was not successful for the origin: ' + originStatus);
                               return;
                           }

                           const originLocation = originResults[0].geometry.location;

                           geocoder.geocode({ 'address': destination }, function(destinationResults, destinationStatus) {
                               if (destinationStatus !== 'OK') {
                                   alert('Geocode was not successful for the destination: ' + destinationStatus);
                                   return;
                               }

                               const destinationLocation = destinationResults[0].geometry.location;

                               // Now request directions
                               const directionsService = new google.maps.DirectionsService();

                               directionsService.route(
                                   {
                                       origin: originLocation,
                                       destination: destinationLocation,
                                       travelMode: 'DRIVING' // Can be changed to 'WALKING', 'BICYCLING', etc.
                                   },
                                   function(response, status) {
                                       if (status === 'OK') {
                                           // Process and display the route
                                           processDirections(response);
                                       } else {
                                           alert('Directions request failed due to ' + status);
                                       }
                                   }
                               );
                           });
                       });
                   });
               }

               function processDirections(response) {
                   // Extract the route geometry
                   const route = response.routes[0].overview_polyline;

                   // Decode the polyline (Google Directions API uses encoded polylines)
                   const path = google.maps.geometry.encoding.decodePath(route);

                   // Convert to OpenLayers coordinates
                   const olPath = path.map(function(latlng) {
                       return ol.proj.fromLonLat([latlng.lng(), latlng.lat()]);
                   });

                   // Create a vector layer for the route
                   if (directionsLayer) {
                       map.removeLayer(directionsLayer);
                   }

                   directionsLayer = new ol.layer.Vector({
                       source: new ol.source.Vector({
                           features: [
                               new ol.Feature({
                                   geometry: new ol.geom.LineString(olPath)
                               })
                           ]
                       }),
                       style: new ol.style.Style({
                           stroke: new ol.style.Stroke({
                               color: '#00FFFF',
                               width: 4
                           })
                       })
                   });

                   map.addLayer(directionsLayer);

                   // Display ETA and distance
                   const legs = response.routes[0].legs;
                   let totalDistance = 0;
                   let totalDuration = 0;

                   legs.forEach(function(leg) {
                       totalDistance += leg.distance.value; // in meters
                       totalDuration += leg.duration.value; // in seconds
                   });

                   const distanceKm = (totalDistance / 1000).toFixed(2); // Convert to km
                   const durationMin = Math.round(totalDuration / 60); // Convert to minutes

                   // Set the content of the new ETA popup
                   const etaInfoContent = `<strong>Route Information:</strong><br>Distance: ${distanceKm} km<br>ETA: ${durationMin} mins`;
                   document.getElementById('eta-popup-content').innerHTML = etaInfoContent;

                   // Calculate the midpoint of the route for popup positioning
                   const midpoint = olPath[Math.floor(olPath.length / 2)];

                   // Create a new ETA popup overlay
                   const etaPopup = new ol.Overlay({
                       element: document.getElementById('eta-popup'),
                       autoPan: {
                           animation: {
                               duration: 250,
                           },
                       },
                   });

                   map.addOverlay(etaPopup);

                   // Set the position of the ETA popup to the midpoint of the route
                   etaPopup.setPosition(midpoint);
                   document.getElementById('eta-popup').style.display = 'block'; // Make the ETA popup visible

                   // Add the close button functionality for the ETA popup
                   document.getElementById('eta-popup-closer').onclick = function () {
                       // Hide the popup when the close button is clicked
                       etaPopup.setPosition(undefined); // Hide the overlay
                       document.getElementById('eta-popup').style.display = 'none'; // Hide the popup container
                       return false; // Prevent default action
                   };

                   // Extract the first and last locations (starting and destination points)
                   const startLatLng = response.routes[0].legs[0].start_location;
                   const endLatLng = response.routes[0].legs[0].end_location;

                   // Convert lat/lng to OpenLayers coordinates for start and end points
                   const startPoint = ol.proj.fromLonLat([startLatLng.lng(), startLatLng.lat()]);
                   const endPoint = ol.proj.fromLonLat([endLatLng.lng(), endLatLng.lat()]);

                   // Add a small circle for the start and end markers
                   const startMarker = new ol.Overlay({
                       position: startPoint,
                       positioning: 'center-center',
                       element: document.createElement('div'),
                       stopEvent: false,
                   });

                   const endMarker = new ol.Overlay({
                       position: endPoint,
                       positioning: 'center-center',
                       element: document.createElement('div'),
                       stopEvent: false,
                   });

                   startMarker.getElement().style.width = '15px';
                   startMarker.getElement().style.height = '15px';
                   startMarker.getElement().style.borderRadius = '50%';
                   startMarker.getElement().style.backgroundColor = 'blue'; // Circle color
                   startMarker.getElement().style.border = '2px solid white';

                   endMarker.getElement().style.width = '15px';
                   endMarker.getElement().style.height = '15px';
                   endMarker.getElement().style.borderRadius = '50%';
                   endMarker.getElement().style.backgroundColor = 'red'; // Circle color
                   endMarker.getElement().style.border = '2px solid white';

                   // Add markers to the map
                   map.addOverlay(startMarker);  // The start marker will not have a popup, only a circle
                   map.addOverlay(endMarker);    // The end marker will have a popup

                   // Create a popup for the destination address (only the address, no circle inside it)
                   const endPopupContent = `<strong>Destination Address:</strong><br>${document.getElementById('destination-input').value}`;
                       if (!endPopup) {
                           endPopup = new ol.Overlay({
                               position: endPoint,
                               positioning: 'bottom-center', // Align popup below the red circle
                               element: document.createElement('div'),
                               stopEvent: false,
                           });
                           endPopup.getElement().style.backgroundColor = 'white';
                           endPopup.getElement().style.padding = '10px';
                           endPopup.getElement().style.borderRadius = '8px';
                           endPopup.getElement().style.border = '1px solid #cccccc';
                           endPopup.getElement().style.boxShadow = '0 2px 5px rgba(0, 0, 0, 0.3)';
                           endPopup.getElement().style.minWidth = '180px';
                           endPopup.getElement().style.textAlign = 'center';
                           endPopup.getElement().style.fontSize = '14px';
                           endPopup.getElement().style.marginBottom = '15px';
                           map.addOverlay(endPopup);
                       }
                       endPopup.getElement().innerHTML = endPopupContent;
                       endPopup.setPosition(endPoint);
               }

               
               let directionsLayer, startMarker, endMarker, etaPopup, endPopup; // Ensure these variables are accessible in the scope

               document.getElementById('destination-button').addEventListener('click', function() {
                   document.getElementById('search-container').style.display = 'none';
                   document.getElementById('dual-search-container').style.display = 'flex';
               });

               // Add a close button to revert back to single search
               const closeButton = document.createElement('button');
               closeButton.innerHTML = 'Close';
               closeButton.style.marginLeft = '10px';
               closeButton.style.padding = '8px 12px';
               closeButton.style.border = 'none';
               closeButton.style.backgroundColor = '#6c757d';
               closeButton.style.color = 'white';
               closeButton.style.borderRadius = '4px';
               closeButton.style.cursor = 'pointer';
               closeButton.style.fontSize = '14px';

               closeButton.addEventListener('click', function() {
                   // Switch to single search view and hide dual search container
                   document.getElementById('dual-search-container').style.display = 'none';
                   document.getElementById('search-container').style.display = 'flex';

                   // Remove the destination line, markers, ETA popups, and destination address popup
                   if (directionsLayer) {
                       map.removeLayer(directionsLayer); // Remove route line
                       directionsLayer = null;
                   }
                   if (startMarker) {
                       map.removeOverlay(startMarker); // Remove start marker
                       startMarker = null;
                   }
                   if (endMarker) {
                       map.removeOverlay(endMarker); // Remove end marker
                       endMarker = null;
                   }
                   if (etaPopup) {
                       etaPopup.setPosition(undefined); // Hide ETA popup
                       document.getElementById('eta-popup').style.display = 'none'; // Hide ETA popup container
                       etaPopup = null;
                   }
                   if (endPopup) {
                       map.removeOverlay(endPopup); // Remove the destination address popup
                       endPopup = null;
                   }
               });

               // Append the close button to the dual search container
               document.getElementById('dual-search-container').appendChild(closeButton);

               // Function to initialize Autocomplete for address inputs
               function initAutocomplete() {
                   const addressInput = document.getElementById('address-input');
                   const originInput = document.getElementById('origin-input');
                   const destinationInput = document.getElementById('destination-input');

                   // Single Address Autocomplete
                   const autocompleteSingle = new google.maps.places.Autocomplete(addressInput, {
                       // types: ['geocode'],
                       componentRestrictions: { country: 'au' }
                   });

                   autocompleteSingle.addListener('place_changed', function() {
                       const place = autocompleteSingle.getPlace();
                       if (!place.geometry) {
                           alert("No details available for input: '" + place.name + "'");
                           return;
                       }

                       const lat = place.geometry.location.lat();
                       const lng = place.geometry.location.lng();
                       const olCoord = ol.proj.fromLonLat([lng, lat]);

                       map.getView().animate({
                           center: olCoord,
                           zoom: 15.3,
                           duration: 2000
                       });

                       addMarker(olCoord, place.formatted_address);
                   });

                   // Dual Address Autocomplete
                   const autocompleteOrigin = new google.maps.places.Autocomplete(originInput, {
                       // types: ['geocode'],
                       componentRestrictions: { country: 'au' }
                   });

                   const autocompleteDestination = new google.maps.places.Autocomplete(destinationInput, {
                       // types: ['geocode'],
                       componentRestrictions: { country: 'au' }
                   });
               }

               // Function to add a marker on the map
               function addMarker(coordinate, address) {
                    // Remove existing marker if any
                    const existingMarker = map.getOverlayById('search-marker');
                    if (existingMarker) {
                        map.removeOverlay(existingMarker);
                    }

                    // Create a new marker element
                    const markerElement = document.createElement('div');
                    markerElement.className = 'search-marker';

                    // Add the Font Awesome icon to the marker
                    markerElement.innerHTML = `
                        <i class="fas fa-map-marker-alt" style="color: #FF0000; font-size: 30px;"></i>
                    `;

                    // Create an OpenLayers overlay for the marker
                    const markerOverlay = new ol.Overlay({
                        position: coordinate,
                        positioning: 'center-center',
                        element: markerElement,
                        stopEvent: false,
                        id: 'search-marker'
                    });

                    // Add the overlay to the map
                    map.addOverlay(markerOverlay);
                }


               // Routing and directions functionality
               function initRouting() {
                   document.getElementById('route-button').addEventListener('click', function() {
                       const origin = document.getElementById('origin-input').value;
                       const destination = document.getElementById('destination-input').value;

                       if (!origin || !destination) {
                           alert('Please enter both origin and destination addresses.');
                           return;
                       }

                       const geocoder = new google.maps.Geocoder();
                       geocoder.geocode({ 'address': origin }, function(originResults, originStatus) {
                           if (originStatus !== 'OK') {
                               alert('Geocode was not successful for the origin: ' + originStatus);
                               return;
                           }

                           const originLocation = originResults[0].geometry.location;

                           geocoder.geocode({ 'address': destination }, function(destinationResults, destinationStatus) {
                               if (destinationStatus !== 'OK') {
                                   alert('Geocode was not successful for the destination: ' + destinationStatus);
                                   return;
                               }

                               const destinationLocation = destinationResults[0].geometry.location;

                               const directionsService = new google.maps.DirectionsService();
                               directionsService.route({
                                   origin: originLocation,
                                   destination: destinationLocation,
                                   travelMode: 'DRIVING'
                               }, function(response, status) {
                                   if (status === 'OK') {
                                       processDirections(response);
                                   } else {
                                       alert('Directions request failed due to ' + status);
                                   }
                               });
                           });
                       });
                   });
               }

               // Process route and display markers and ETA
               function processDirections(response) {
                   const route = response.routes[0].overview_polyline;
                   const path = google.maps.geometry.encoding.decodePath(route);
                   const olPath = path.map(function(latlng) {
                       return ol.proj.fromLonLat([latlng.lng(), latlng.lat()]);
                   });

                   if (directionsLayer) {
                       map.removeLayer(directionsLayer);
                   }

                   directionsLayer = new ol.layer.Vector({
                       source: new ol.source.Vector({
                           features: [
                               new ol.Feature({
                                   geometry: new ol.geom.LineString(olPath)
                               })
                           ]
                       }),
                       style: new ol.style.Style({
                           stroke: new ol.style.Stroke({
                               color: '#00FFFF',
                               width: 4
                           })
                       })
                   });

                   map.addLayer(directionsLayer);

                   const legs = response.routes[0].legs;
                   let totalDistance = 0;
                   let totalDuration = 0;
                   legs.forEach(function(leg) {
                       totalDistance += leg.distance.value;
                       totalDuration += leg.duration.value;
                   });

                   const distanceKm = (totalDistance / 1000).toFixed(2);
                   const durationMin = Math.round(totalDuration / 60);


                   const etaInfoContent = `<strong>Route Information:</strong><br>Distance: ${distanceKm} km<br>ETA: ${durationMin} mins`;
                   document.getElementById('eta-popup-content').innerHTML = etaInfoContent;

                   const midpoint = olPath[Math.floor(olPath.length / 2)];
                   if (!etaPopup) {
                       etaPopup = new ol.Overlay({
                           element: document.getElementById('eta-popup'),
                           autoPan: { animation: { duration: 250 } },
                       });
                       map.addOverlay(etaPopup);
                   }
                   etaPopup.setPosition(midpoint);
                   document.getElementById('eta-popup').style.display = 'block';

                   document.getElementById('eta-popup-closer').onclick = function () {
                       etaPopup.setPosition(undefined); // Hide ETA popup
                       document.getElementById('eta-popup').style.display = 'none'; // Hide ETA popup container
                       return false;
                   };

                   const startLatLng = response.routes[0].legs[0].start_location;
                   const endLatLng = response.routes[0].legs[0].end_location;
                   const startPoint = ol.proj.fromLonLat([startLatLng.lng(), startLatLng.lat()]);
                   const endPoint = ol.proj.fromLonLat([endLatLng.lng(), endLatLng.lat()]);

                   // Add or update the start marker
                   if (startMarker) map.removeOverlay(startMarker);
                   startMarker = new ol.Overlay({
                       position: startPoint,
                       positioning: 'center-center',
                       element: document.createElement('div'),
                       stopEvent: false,
                   });
                   startMarker.getElement().style.width = '15px';
                   startMarker.getElement().style.height = '15px';
                   startMarker.getElement().style.borderRadius = '50%';
                   startMarker.getElement().style.backgroundColor = 'blue';
                   startMarker.getElement().style.border = '2px solid white';
                   map.addOverlay(startMarker);

                   // Add or update the end marker
                   if (endMarker) map.removeOverlay(endMarker);
                   endMarker = new ol.Overlay({
                       position: endPoint,
                       positioning: 'center-center',
                       element: document.createElement('div'),
                       stopEvent: false,
                   });
                   endMarker.getElement().style.width = '15px';
                   endMarker.getElement().style.height = '15px';
                   endMarker.getElement().style.borderRadius = '50%';
                   endMarker.getElement().style.backgroundColor = 'red';
                   endMarker.getElement().style.border = '2px solid white';
                   map.addOverlay(endMarker);

                   const extent = ol.extent.boundingExtent([startPoint, endPoint]);

                   // Fit the map view to the bounding box with padding
                       map.getView().fit(extent, {
                       padding: [200, 200, 200, 200], // Top, Right, Bottom, Left
                       duration: 2000, // Smooth animation
                   });
                   
                   const endPopupContent = `<strong>Destination Address:</strong><br>${document.getElementById('destination-input').value}`;
                   
                   endPopup = new ol.Overlay({
                       position: endPoint,
                       positioning: 'bottom-center',
                       element: document.createElement('div'),
                       stopEvent: false
                   });
                   endPopup.getElement().innerHTML = endPopupContent;

                   endPopup.getElement().style.backgroundColor = 'white';
                   endPopup.getElement().style.padding = '10px';
                   endPopup.getElement().style.borderRadius = '8px';
                   endPopup.getElement().style.border = '1px solid #cccccc';
                   endPopup.getElement().style.boxShadow = '0 2px 5px rgba(0, 0, 0, 0.3)';
                   endPopup.getElement().style.minWidth = '180px';
                   endPopup.getElement().style.textAlign = 'center';
                   endPopup.getElement().style.fontSize = '14px';

                   map.addOverlay(endPopup);
                   endPopup.getElement().style.marginBottom = '15px';
               }

               window.addEventListener('load', function() {
                   initAutocomplete();
                   initRouting();
               });


           }
       </script>
    </body>
</html>
